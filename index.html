<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Доступ в FastGuide — оплата</title>
<meta name="color-scheme" content="dark">
<style>
  :root{
    --bg:#030305;
    --panel:#0d0d0f;
    --muted:#9aa0a6;
    --accent:#2ac26b;
    --accent-2:#21a858;
    --card-shadow: 0 20px 50px rgba(0,0,0,0.55);
    --radius:14px;
    --glass: rgba(255,255,255,0.02);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#070708);color:#fff;-webkit-font-smoothing:antialiased}
  .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:22px}
  .app{width:100%;max-width:420px;border-radius:20px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);box-shadow:var(--card-shadow);overflow:hidden}
  .top{display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-bottom:1px solid rgba(255,255,255,0.02)}
  .top .title{font-weight:700;font-size:16px}
  .top .sub{font-size:12px;color:var(--muted)}
  .card{padding:18px;background:linear-gradient(180deg,var(--panel), #0b0b0c)}
  .steps{display:flex;align-items:center;gap:6px;margin-bottom:14px}
  .step{flex:1;text-align:center;font-size:12px;color:var(--muted)}
  .step .dot{width:34px;height:34px;border-radius:999px;margin:0 auto 8px;display:flex;align-items:center;justify-content:center;background:var(--glass);border:1px solid rgba(255,255,255,0.04);font-weight:700;color:var(--muted)}
  .step.active .dot{background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#02120a;box-shadow:0 8px 22px rgba(34,170,102,0.18)}
  .step.done .dot{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .heading{font-size:26px;font-weight:700;margin:6px 0 6px}
  .subhead{color:var(--muted);margin-bottom:14px}
  .methods{display:flex;gap:12px;margin-bottom:14px}
  .method{flex:1;padding:12px;border-radius:12px;background:#151515;border:1px solid rgba(255,255,255,0.02);cursor:pointer;text-align:center;font-weight:600;color:#e9ecef;user-select:none}
  .method.active{background:#1f1f1f;box-shadow:inset 0 -4px 0 rgba(0,0,0,0.25)}
  .field{width:100%;padding:14px;border-radius:12px;border:none;background:#0b0b0b;color:#fff;font-size:15px;margin-bottom:12px;outline:none}
  .price-row{display:flex;align-items:baseline;justify-content:space-between;margin:14px 0}
  .price{font-size:36px;font-weight:800;letter-spacing:-0.02em}
  .price-currency{font-size:14px;color:var(--muted);margin-left:8px;font-weight:600}
  .btn{width:100%;display:inline-block;padding:14px;border-radius:12px;border:none;background:linear-gradient(180deg,var(--accent),var(--accent-2));color:#02120a;font-weight:800;font-size:16px;cursor:pointer;transition:transform .12s ease,box-shadow .12s ease}
  .btn:active{transform:translateY(1px)}
  .ghost{display:block;margin-top:12px;text-align:center;color:var(--muted);text-decoration:none}
  .confirm{background:#0a0a0a;border-radius:12px;padding:12px;border:1px solid rgba(255,255,255,0.02)}
  .row{padding:12px;border-radius:10px;background:rgba(255,255,255,0.01);margin-bottom:8px}
  .label{font-size:12px;color:var(--muted);margin-bottom:6px}
  .value{font-size:16px;font-weight:700}
  .wait{display:flex;flex-direction:column;align-items:center;gap:14px;padding:18px}
  .orb{width:96px;height:96px;border-radius:999px;background:linear-gradient(180deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;box-shadow:0 20px 60px rgba(40,194,110,0.14)}
  .wait p{font-size:18px;text-align:center;color:#e7efe9}
  .muted{color:var(--muted);font-size:13px;text-align:center;margin-top:8px}
  @media (max-width:420px){
    .heading{font-size:22px}
    .price{font-size:30px}
    .top{padding:12px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="app" role="application" aria-label="Оплата — Доступ в FastGuide">
      <div class="top">
        <div>
          <div class="title">FastGuide</div>
          <div class="sub">мини-приложение</div>
        </div>
        <div style="font-size:13px;color:var(--muted)">Оплата</div>
      </div>

      <div class="card" id="card">
        <div class="steps" aria-hidden="true">
          <div class="step active" id="stepIndicator1"><div class="dot">1</div>Выбор</div>
          <div class="step" id="stepIndicator2"><div class="dot">2</div>Данные</div>
          <div class="step" id="stepIndicator3"><div class="dot">3</div>Оплата</div>
        </div>

        <!-- STEP 1 -->
        <div id="step1">
          <div class="heading">Доступ в FastGuide</div>
          <div class="subhead">Выберите метод оплаты</div>

          <div class="methods" role="list">
            <div class="method" id="m_rus" role="button" tabindex="0" onclick="choose('Банк РФ', this)">Банк РФ — 390 ₽</div>
            <div class="method" id="m_int" role="button" tabindex="0" onclick="choose('Иностранный банк', this)">Иностранный банк — 5 $</div>
          </div>

          <input id="email" class="field" type="email" inputmode="email" autocomplete="email" placeholder="example@gmail.com" aria-label="Email">

          <div class="price-row">
            <div class="muted">Текущая сумма</div>
            <div class="price" id="priceDisplay">390 <span class="price-currency">RUB</span></div>
          </div>

          <button class="btn" id="nextBtn" onclick="toStep2()">Далее</button>
        </div>

        <!-- STEP 2 -->
        <div id="step2" style="display:none">
          <div class="heading" style="font-size:20px">Проверьте данные</div>
          <div class="muted" style="margin-bottom:12px">Убедитесь, что всё введено верно</div>

          <div class="confirm">
            <div class="row">
              <div class="label">Наименование товара</div>
              <div class="value">Доступ в FastGuide</div>
            </div>

            <div class="row">
              <div class="label">Метод оплаты</div>
              <div id="c_method" class="value">—</div>
            </div>

            <div class="row">
              <div class="label">Ваш E-mail</div>
              <div id="c_email" class="value">—</div>
            </div>

            <div class="row" style="margin-bottom:0">
              <div class="label">Стоимость</div>
              <div id="c_price" class="value">—</div>
            </div>
          </div>

          <div style="margin-top:16px">
            <button class="btn" id="payBtn" onclick="proceedToPay()">Перейти к оплате</button>
            <a class="ghost" href="#" onclick="backToStep1(event)">Вернуться назад</a>
          </div>
        </div>

        <!-- STEP 3 -->
        <div id="step3" style="display:none">
          <div class="wait">
            <div class="orb" aria-hidden="true">
              <svg width="46" height="46" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M8 7h8" stroke="#02120a" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8 17h8" stroke="#02120a" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16 7.5s-1.5 1.5-4 1.5-4-1.5-4-1.5" stroke="#02120a" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8 16.5s1.5-1.5 4-1.5 4 1.5 4 1.5" stroke="#02120a" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>

            <p><strong>Ожидание подтверждения оплаты…</strong></p>
            <a id="openPayment" class="ghost" href="#" target="_blank" rel="noopener noreferrer">Открыть страницу оплаты</a>
            <div class="muted">Если оплата подтверждена — страница обновится автоматически</div>

            <div id="devActions" style="margin-top:10px;display:none">
              <button style="padding:8px 12px;border-radius:8px;border:none;background:#fff;color:#000;cursor:pointer" onclick="simulateSuccess()">Симулировать оплату (debug)</button>
            </div>
          </div>
        </div>

      </div><!-- card -->
    </div><!-- app -->
  </div><!-- wrap -->

<script>
  // LINKS (подставлены твои ссылки)
  const LAVA_RUS = 'https://app.lava.top/ru/products/9ea4bb05-5fb7-414f-9813-ac5855b2029a/9cf64ab1-f6c0-4243-a552-d1a2f0e50852?currency=EUR';
  const LAVA_INT = 'https://app.lava.top/ru/products/9ea4bb05-5fb7-414f-9813-ac5855b2029a/6783c63f-0fd4-4afb-9d99-951df743767b?currency=EUR';

  // PRICES
  const PRICE_RUB = {amount: '390', label: 'RUB'};
  const PRICE_USD = {amount: '5', label: 'USD'};

  // STATE
  let method = ''; // 'rus' or 'int'
  let email = '';

  // ELEMENTS
  const mRus = document.getElementById('m_rus');
  const mInt = document.getElementById('m_int');
  const step1 = document.getElementById('step1');
  const step2 = document.getElementById('step2');
  const step3 = document.getElementById('step3');
  const p1 = document.getElementById('stepIndicator1');
  const p2 = document.getElementById('stepIndicator2');
  const p3 = document.getElementById('stepIndicator3');
  const cMethod = document.getElementById('c_method');
  const cEmail = document.getElementById('c_email');
  const cPrice = document.getElementById('c_price');
  const priceDisplay = document.getElementById('priceDisplay');
  const openPayment = document.getElementById('openPayment');

  // choose method and update displayed price
  function choose(name, el){
    method = (name === 'Банк РФ') ? 'rus' : 'int';
    [mRus, mInt].forEach(x => x.classList.remove('active'));
    el.classList.add('active');
    // update price shown
    if(method === 'rus'){
      priceDisplay.innerHTML = `${PRICE_RUB.amount} <span class="price-currency">${PRICE_RUB.label}</span>`;
    } else {
      priceDisplay.innerHTML = `${PRICE_USD.amount} <span class="price-currency">${PRICE_USD.label}</span>`;
    }
    document.getElementById('email').focus();
  }

  function isEmail(v){
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
  }

  function toStep2(){
    const e = document.getElementById('email').value.trim();
    if(!method){ alert('Выберите метод оплаты'); return; }
    if(!isEmail(e)){ alert('Введите корректный email'); document.getElementById('email').focus(); return; }
    email = e;
    // fill confirm
    cMethod.textContent = (method === 'rus') ? 'Банк РФ' : 'Иностранный банк';
    cEmail.textContent = email;
    cPrice.textContent = (method === 'rus') ? `${PRICE_RUB.amount} ${PRICE_RUB.label}` : `${PRICE_USD.amount} ${PRICE_USD.label}`;

    // UI progress
    p1.classList.remove('active'); p1.classList.add('done');
    p2.classList.add('active');

    // show step2
    step1.style.display = 'none';
    step2.style.display = 'block';
    window.scrollTo({top:0,behavior:'smooth'});
  }

  function backToStep1(e){
    if(e) e.preventDefault();
    step2.style.display = 'none';
    step1.style.display = 'block';
    p2.classList.remove('active'); p1.classList.remove('done'); p1.classList.add('active');
  }

  function proceedToPay(){
    // build url with email as param if possible
    let url = (method === 'rus') ? LAVA_RUS : LAVA_INT;
    try {
      const u = new URL(url);
      if(email) u.searchParams.set('buyer_email', email);
      u.searchParams.set('utm_source', 'fastguide_miniapp');
      url = u.toString();
    } catch(e){}
    // set manual open href
    openPayment.href = url;
    // open
    const wnd = window.open(url, '_blank');
    if(!wnd){
      alert('Браузер заблокировал открытие. Нажмите "Открыть страницу оплаты".');
    }

    // show waiting
    step2.style.display = 'none';
    step3.style.display = 'block';
    p2.classList.remove('active'); p2.classList.add('done');
    p3.classList.add('active');

    startPolling();
  }

  // Polling placeholder - implement server endpoint that checks payment status by order/email
  let pollTimer = null;
  function startPolling(){
    const params = new URLSearchParams(location.search);
    if(params.get('debug') === '1') document.getElementById('devActions').style.display = 'block';
    // Example for production:
    // pollTimer = setInterval(async ()=>{
    //   const res = await fetch(`/check-payment?email=${encodeURIComponent(email)}`);
    //   const data = await res.json();
    //   if(data && data.status === 'paid'){ onPaid(data); clearInterval(pollTimer); }
    // }, 4000);
  }

  function onPaid(info){
    clearInterval(pollTimer);
    alert('Оплата подтверждена — выдан доступ.');
    // here you should show access or redirect to content
  }

  function simulateSuccess(){ onPaid({status:'paid'}); }

  // keyboard UX
  document.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      if(step1.style.display !== 'none') toStep2();
      else if(step2.style.display !== 'none') proceedToPay();
    }
  });

  // make method elements keyboard-accessible
  [mRus, mInt].forEach(el=>{
    el.addEventListener('keydown', (ev)=>{
      if(ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); el.click(); }
    });
  });
</script>
</body>
</html>
